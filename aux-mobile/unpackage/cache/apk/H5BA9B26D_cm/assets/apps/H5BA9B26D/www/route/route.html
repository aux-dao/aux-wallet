<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>Hello MUI</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="stylesheet" href="../css/mui.min.css">

		<style>
			html,
			body {
				background-color: #efeff4;
			}

			.title {
				padding: 20px 15px 10px;
				color: #6d6d72;
				font-size: 15px;
				background-color: #fff;
			}

			.mui-icon-bars,
			.mui-icon-close {
				color: #FFFFFF !important;
			}

			.mui-bar-nav {
				background-color: #d74b28 !important;
			}

			.mui-icon-plus {
				color: #FFFFFF !important;
			}

			.mui-title {
				color: #FFFFFF !important;
			}

			.mui-slider-handle {
				padding-right: 110px;
			}

			.address {
				font-size: 12px !important;
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<a class="mui-icon mui-icon-bars mui-pull-left"></a>
			<a class="mui-icon mui-icon-plus mui-pull-right"></a>
			<h1 class="mui-title">兑换记录</h1>
		</header>

		<div class="mui-content">
			<div id="slider" class="mui-slider mui-fullscreen">
				<div id="sliderSegmentedControl" class="mui-scroll-wrapper mui-slider-indicator mui-segmented-control mui-segmented-control-inverted">
					<div class="mui-scroll">
						<a class="mui-control-item mui-active " fw="0" href="#item1mobile">
							OXS兑换记录
						</a>
						<a class="mui-control-item" fw="1" href="#item2mobile">
							OXC兑换记录
						</a>

					</div>
				</div>
				<div class="mui-slider-group">
					<div id="item1mobile" class="mui-slider-item mui-control-content mui-active">
						<div id="scroll1" class="mui-scroll-wrapper">
							<div class="mui-scroll">
								<ul class="mui-table-view fw0">

								</ul>
							</div>
						</div>
					</div>
					<div id="item2mobile" class="mui-slider-item mui-control-content">
						<div class="mui-scroll-wrapper">
							<div class="mui-scroll">
								<ul class="mui-table-view fw1">

								</ul>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div> 
		<script src="../js/mui.min.js"></script>
		<script src="../js/mui.pullToRefresh.js"></script>
		<script src="../js/mui.pullToRefresh.material.js"></script>
		<script src="../js/appBundle.js"></script>
		<script type="text/javascript" src="../js/appui.js"></script>
		<script src="../js/begin.js"></script>
		<script src="../js/mui.picker.js"></script>
		<script type="text/javascript" src="../js/mui.custompoppicker.js"></script>
		<script>
			mui.init({
				swipeBack: true
			});

			mui.plusReady(function() {
				mui('.mui-bar').on('tap', '.mui-pull-left', function() {
					var RegSwap = plus.webview.getWebviewById("RegSwap");
					if (!RegSwap) {
						RegSwap = mui.preload({
							"id": 'RegSwap',
							"url": '/route/RegSwap.html'
						});
						var id = setInterval(function() {
								clearInterval(id);
								mui.fire(RegSwap, 'show', null);
								RegSwap.show("pop-in");
							},
							20);
					} else {
						RegSwap.show("pop-in");
					}
				});
				mui('.mui-bar').on('tap', '.mui-pull-right', function() {
					var PushEthTx = plus.webview.getWebviewById("PushEthTx");
					if (!PushEthTx) {
						PushEthTx = mui.preload({
							"id": 'PushEthTx',
							"url": '/route/PushEthTx.html'
						});
						var id = setInterval(function() {
								clearInterval(id);
								mui.fire(PushEthTx, 'show', null);
								PushEthTx.show("pop-in");
							},
							20);
					} else {
						PushEthTx.show("pop-in");
					}
				});
				mui('.mui-bar').on('tap', '.mui-icon', function() {
					//					var newcontactPage = plus.webview.getWebviewById("newcontact");
					//
					//					if(!newcontactPage) {
					//						newcontactPage = mui.preload({
					//							"id": 'newcontact',
					//							"url": 'newcontact.html'
					//						});
					//						var id = setInterval(function() {
					//							clearInterval(id);
					//							mui.fire(newcontactPage, 'show', null);
					//							newcontactPage.show("pop-in");
					//						}, 20);
					//					} else {
					//						newcontactPage.show("pop-in");
					//					}
				});
				var fw = 0;
				var pageindex0 = 0;
				var pageindex1 = 0;
				mui.each(document.querySelectorAll('.mui-slider-group .mui-scroll'), function(index, pullRefreshEl) {
					mui(pullRefreshEl).pullToRefresh({
						down: {
							callback: function() {
								var self = this;
								if (fw == 0) {
									pageindex0++;
									refreshRoom(pageindex0, 1);
								} else {
									pageindex1++;
									refreshRoom(pageindex1, 1);
								}
								self.endPullUpToRefresh();
							}
						},
						up: {
							callback: function() {
								var self = this;
								if (fw == 0) {
									pageindex0++;
									refreshRoom(pageindex0, 1);
								} else {
									pageindex1++;
									refreshRoom(pageindex1, 1);
								}
								self.endPullUpToRefresh();
							}
						}
					});
				});
				var createRecordsFragment = function(ul, records) {
					var fragment = document.createDocumentFragment();
					var li;
					for (var i = 0; i < records.length; i++) {
						var record = records[i];
						li = document.createElement('li');
						li.className = 'mui-table-view-cell';
						li.innerHTML = record.ethaddress + '<h3 class="mui-primary">' + record.amount +
							'</h3>';
						fragment.appendChild(li);
					}
					return fragment;
				};
				window.addEventListener('relogin', function(e) {
					gtapp.TryGetWallet(function(wt) {});
				});
				window.addEventListener('refreshrecord', function(e) {
					refreshRoom(0, 0);
				});
				mui('.mui-scroll').on('tap', '.mui-control-item', function(e) {
					fw = this.getAttribute('fw');
					refreshRoom(0, 0);
				});
				mui('.mui-bar').on('tap', '.mui-pull-right', function() {
				
				});
				mui('.mui-bar').on('tap', '.mui-pull-left', function() {
				
				});
				var refreshRoom = function(pageindex, flag) {
					gtapp.TryGetWallet(function(wt) {
						wt.getContracts()[0].getAddress().then(function(result) {
							if (fw == 0) {
								gtapp.PullSwapRecords(1,result, pageindex, function(response) {
									if (response.result) {
										var ul = document.querySelector('.fw0');
										if (flag == 0) {
											ul.innerHTML = "";
											pageindex0 = 0;
										}
										ul.appendChild(createRecordsFragment(ul, response.records));
				
									}
								});
							} else {
								gtapp.PullSwapRecords(2,result, pageindex, function(response) {
									if (response.result) {
										var ul = document.querySelector('.fw1');
										if (flag == 0) {
											ul.innerHTML = "";
											pageindex0 = 0;
										}
										ul.appendChild(createRecordsFragment(ul, response.records));
									}
								});
							}
						});
					});
				};
				refreshRoom(0, 0);
			});
		</script>
	</body>

</html>
